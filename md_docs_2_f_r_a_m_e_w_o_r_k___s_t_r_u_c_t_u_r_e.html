<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="google" content="notranslate" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SAF: Framework Structure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-498Z1C2LX5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-498Z1C2LX5');
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SAF
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2_f_r_a_m_e_w_o_r_k___s_t_r_u_c_t_u_r_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Framework Structure</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a> <img src="framework.svg" alt="" style="pointer-events: none;" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Include</h1>
<p>The framework's master include header is:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="saf_8h.html">saf.h</a>&quot;</span></div>
<div class="ttc" id="asaf_8h_html"><div class="ttname"><a href="saf_8h.html">saf.h</a></div><div class="ttdoc">Main include header for the Spatial_Audio_Framework (SAF)</div></div>
</div><!-- fragment --><p>Optionally, if you would like to carry over the CBLAS/LAPACK routines (and the functions of any other SAF external library) to use in your own project, then also include the following header: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="saf__externals_8h.html">saf_externals.h</a>&quot;</span>  </div>
<div class="ttc" id="asaf__externals_8h_html"><div class="ttname"><a href="saf__externals_8h.html">saf_externals.h</a></div><div class="ttdoc">Include header for SAF externals.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2"></a>
Modules</h1>
<p>The framework comprises the following core modules (<b>ISC</b>):</p><ul>
<li><b>saf_hoa</b> - a collection of higher-order Ambisonics binaural and loudspeaker decoders.</li>
<li><b>saf_sh</b> - spherical harmonic and spherical array processing related functions.</li>
<li><b>saf_vbap</b> - Vector-base Amplitude Panning (VBAP) functions.</li>
<li><b>saf_cdf4sap</b> - Covariance Domain Framework for Spatial Audio Processing (CDF4SAP).</li>
<li><b>saf_hrir</b> - HRIR/HRTF related functions (estimating ITDs, HRTF interpolation, diffuse-field EQ etc.).</li>
<li><b>saf_reverb</b> - a collection of reverbs and room simulation algorithms.</li>
<li><b>saf_utilities</b> - a collection of useful utility functions and cross-platform wrappers.</li>
</ul>
<p>The framework also includes the following optional modules:</p><ul>
<li><b>saf_sofa_reader</b> - a simple SOFA file reader (<b>ISC</b>).</li>
<li><b>saf_tracker</b> - a particle-filtering based tracker (<b>GPLv2</b>).</li>
</ul>
<p>To enable optional framework modules, simply add the relevant pre-processor definition: </p><div class="fragment"><div class="line">SAF_ENABLE_SOFA_READER_MODULE  # to enable saf_sofa_reader</div>
<div class="line">SAF_ENABLE_TRACKER_MODULE      # to enable saf_tracker</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3"></a>
Resources</h1>
<p>The <b>saf_utilities</b> module also inherits and offers use of the following third-party <b>resources</b>:</p><ul>
<li><a href="https://github.com/jvilkamo/afSTFT"><b>afSTFT</b></a> - a slightly modified version of the alias-free Short-Time Fourier Transform (afSTFT) filterbank (<b>MIT</b>).</li>
<li><a href="https://github.com/leomccormack/md_malloc"><b>md_malloc</b></a> - a utility for allocating contiguous multi-dimensional arrays (<b>MIT</b>).</li>
<li><a href="https://github.com/leomccormack/convhull_3d"><b>convhull_3d</b></a> - for building 3-D convex hulls (<b>MIT</b>).</li>
<li><a href="https://github.com/mborgerding/kissfft"><b>kissFFT</b></a> - the default FFT implementation for when no optimised alternative is linked (<b>BSD-3-Clause</b>).</li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
Dependencies</h1>
<p>The only hard dependency for SAF is a library (or a combination of libraries) which supports the <a href="https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms#Implementations">CBLAS</a> and <a href="https://en.wikipedia.org/wiki/LAPACK">LAPACK</a> standards.</p>
<p>For more details, refer to: <a class="el" href="md_docs_2_p_e_r_f_o_r_m_a_n_c_e___l_i_b_r_a_r_y___i_n_s_t_r_u_c_t_i_o_n_s.html">**PERFORMANCE_LIBRARY_INSTRUCTIONS.md**</a></p>
<h2><a class="anchor" id="autotoc_md5"></a>
Optional externals</h2>
<p>In order to use the optional built-in <a href="https://www.sofaconventions.org/mediawiki/index.php/SOFA_(Spatially_Oriented_Format_for_Acoustics)">SOFA</a> reader module (<b>saf_sofa_reader</b>), your project must also link against the <a href="https://www.unidata.ucar.edu/software/netcdf/">netCDF</a> library (including its dependencies).</p>
<p>For more details, refer to: **SOFA_READER_MODULE_DEPENDENCIES.md**</p>
<p>Optionally, Intel's <a href="https://software.intel.com/content/www/us/en/develop/tools/integrated-performance-primitives.html">Integrated Performance Primitives (IPP)</a> may be employed for the FFT with the following definition: </p><div class="fragment"><div class="line">SAF_USE_INTEL_IPP            </div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
Contributing</h1>
<p>Contributions are very much welcomed and encouraged. Please feel free to make suggestions, pull-requests, or get in touch (via leo.mccormack(at)aalto.fi or github "issues") if you would like to discuss additions to the framework. These additions can come in many forms; including:</p><ul>
<li>bug fixes or optimisations to existing code</li>
<li>adding new functionality (which falls under the scope of an existing module) to an existing module</li>
<li>adding a new utility to the <b>saf_utilities</b> module or an entirely new module (see below)</li>
<li>using the framework to create new <b>examples</b>, <b>extras</b>, or unit tests</li>
<li>documentation improvements</li>
</ul>
<h1><a class="anchor" id="autotoc_md7"></a>
Module structure</h1>
<p>All modules should reside in the <b>framework/modules</b> folder, named in lower-case and with the <b>saf_</b> prefix. The main include header for the module should also have the same name as this folder; e.g.:</p>
<div class="fragment"><div class="line">framework/modules/saf_new_module/saf_new_module.h</div>
<div class="line">framework/modules/saf_sh/saf_sh.h</div>
</div><!-- fragment --><p>The rest of the module can be organised as you wish. However, one suggestion is to use the following structure:</p>
<div class="fragment"><div class="line">saf_new_module.h           # Main header comprising functions/structs/enums that the user can interface with</div>
<div class="line">saf_new_module_internal.h  # Internal header comprising functions/structs/enums that only the module uses</div>
<div class="line">saf_new_module.c           # Source code for the functions declared in the main header</div>
<div class="line">saf_new_module_internal.c  # Source code for the functions declared in the internal header</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
Adding a module to the framework</h2>
<p>All core modules are included by the <b><a class="el" href="saf_8h.html" title="Main include header for the Spatial_Audio_Framework (SAF)">framework/include/saf.h</a></b> master include header using its relative path, and prefaced with a definition of the same name (except upper case). Doxygen documentation should then be added for this definition, which: describes the module, its license, and any dependencies. For example: </p><div class="fragment"><div class="line"><span class="comment">/* *  </span></div>
<div class="line"><span class="comment"> * SAF Module: HOA</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * A collection of higher-order Ambisonics related functions; many of which are</span></div>
<div class="line"><span class="comment"> * derived from the Matlab library found in [1] (BSD-3-Clause License).</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ## Dependencies</span></div>
<div class="line"><span class="comment"> *   saf_utilities.h, saf_vbap.h, saf_sh.h</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @see [1] https://github.com/polarch/Higher-Order-Ambisonics</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * License: ISC</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define SAF_HOA_MODULE</span></div>
<div class="line"><span class="preprocessor">#include &quot;../modules/saf_hoa/saf_hoa.h&quot;</span></div>
</div><!-- fragment --><p>Optional modules are also included by <b><a class="el" href="saf_8h.html" title="Main include header for the Spatial_Audio_Framework (SAF)">framework/include/saf.h</a></b> in a similar manner as with the core modules, except they should be guarded by a <b>SAF_ENABLE_X_MODULE</b> definition and instructions should be provided regarding how to enable it, along with a link to instructions on how to build/link any dependencies. For example: </p><div class="fragment"><div class="line"><span class="comment">/* *</span></div>
<div class="line"><span class="comment"> * SAF Module: SOFA_Reader</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * A simple SOFA file reader that returns only the bare minimum needed to</span></div>
<div class="line"><span class="comment"> * load HRIR data.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ## Enable instructions</span></div>
<div class="line"><span class="comment"> *   Add this pre-processor definition to your project:</span></div>
<div class="line"><span class="comment"> *       SAF_ENABLE_SOFA_READER_MODULE</span></div>
<div class="line"><span class="comment"> *   and ensure that the netcdf library is also linked to your project. More</span></div>
<div class="line"><span class="comment"> *   information can be found in:</span></div>
<div class="line"><span class="comment"> *       docs/SOFA_READER_MODULE_DEPENDENCIES.md</span></div>
<div class="line"><span class="comment"> * ## Dependencies</span></div>
<div class="line"><span class="comment"> *   saf_utilities.h, saf_hrir.h, netcdf</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * License: ISC</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define SAF_SOFA_READER_MODULE</span></div>
<div class="line"><span class="preprocessor">#ifdef  SAF_ENABLE_SOFA_READER_MODULE</span></div>
<div class="line"><span class="preprocessor"># include &quot;../modules/saf_sofa_reader/saf_sofa_reader.h&quot;</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* SAF_ENABLE_SOFA_READER_MODULE */</span><span class="preprocessor"></span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
Coding style</h2>
<p>All code should be written in C and compile under C99 compliant compilers and the ancient MSVC compiler. Note that complex number wrappers (<b><a class="el" href="saf__utility__complex_8h.html" title="Contains wrappers for handling complex numbers across both C99-compliant compilers and Microsoft Visu...">saf_utilities/saf_utility_complex.h</a></b>) have been provided to make this latter requirement a bit easier, but we can also help port C99-only code to be MSVC compliant if needed.</p>
<p>As for coding-style, there are no strict requirements, only suggestions. In general, taking an existing SAF module and using it as a basis for developing a new module is probably the easiest way to go. However, suggested coding styles are also listed below:</p><ul>
<li>Indentations should be 4 spaces in length - no tabs please!</li>
<li>Comments are preferred with the /* comment */ syntax, rather than //</li>
<li>Comments and function declarations in header files should respect an 80 character margin</li>
<li>Doxygen syntax should be used to document all functions/structures open to the user (i.e., the main header file of the module).</li>
<li>Functions/structures open to the user should be particularly verbose and make reference to the appropriate publications.</li>
<li>Using Doxygen syntax to also document internal functions is preferred, but we'll take any documentation over no documentation.</li>
<li>Breaking up source code to describe what is going on with comments will make it easier to find and fix bugs in the future.</li>
<li>Open curly brackets should come after "for" loops and "if" statements on the same line.</li>
<li>Open curly brackets should be omitted for "for" loops and "if" statements that comprise only one line of execution.</li>
<li>Structure handles are preferred to be of type "void*" if the structure is only visible internally to the module (i.e., defined in the module's internal header).</li>
<li>Structure handles should be of their declaration type if the structure is visible to the user (i.e., defined in the main module header).</li>
<li>Using the SAF-native "float_complex" and "double_complex" structures for handling complex numbers is favoured for all user interface functions.</li>
<li>Writing appropriate unit tests (which also demonstrate the functionality of your added code) to accompany your module is highly recommended. See the <b>test</b> folder for more details.</li>
</ul>
<h2><a class="anchor" id="autotoc_md10"></a>
Dependencies</h2>
<p>If the new module requires third-party dependencies, (which are not already included in the framework), then there are a few options to add them:</p><ul>
<li>If the dependency is permissively licensed and is a relatively small library (comprising 1-3 source files), then these may be added to the module itself or, if the dependency may be useful to other modules, it can be added to the <b>framework/resources</b> folder and inherited by the <b>saf_utilities</b> module. <br  />
</li>
<li>If the dependency is <b>not</b> permissively licensed and is a relatively small library (comprising 1-3 source files), then these may be added to the module itself and included only internally by the module.</li>
<li>If the dependency is large, then it should be included via the <b><a class="el" href="saf__externals_8h.html" title="Include header for SAF externals.">framework/include/saf_externals.h</a></b> header, and detailed instructions regarding how to build/link these libraries should be added to the <b>docs</b> folder.</li>
</ul>
<p>Note: your module can only be added as a <b>core</b> module if it is free from large dependencies and comprises only permissively licensed code (see below).</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Licensing</h2>
<p>All core modules must be released under the <a href="https://choosealicense.com/licenses/isc/">ISC License</a> and only use third-party code that is provided under similar permissive licensing terms (ISC, MIT, BSD etc.).</p>
<p>Optional modules may be released under alternative licenses. If you would prefer (or are required) to release your module under a copyleft license, then you may do so. For example, the <b>saf_tracker</b> module is provided under the terms of the copyleft <a href="https://choosealicense.com/licenses/gpl-2.0/">GNU GPLv2 License</a>. However, please discuss with us if you wish to use a license other than ISC or GPLv2. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Nov 21 2023 13:21:54 for SAF by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
<script type="text/javascript">
  $(function() {
      $(document).ready(function(){
         toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
         toggleButton.title = "Toggle Light/Dark Mode"
         document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
     })
  })
</script>
</body>
</html>
